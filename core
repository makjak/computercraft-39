-- pos 1 = fuel
-- pos 2 = plug
-- pos 3,4,5 = junk
-- pos 6 + = goodies
function isValuable()
	-- check junk
	for i=3,4 do
		turtle.select(i)
		if not turtle.detect() or turtle.compare() then
			return false
		end
	end

	return true
end

function isChest()
	turtle.select(5)
	if turtle.compare() then
		return true
	end
	return false
end

function isChestDown()
	turtle.select(5)
	if turtle.compareDown() then
		return true
	end
	return false
end

function isChestUp()
	turtle.select(5)
	if turtle.compareUp() then
		return true
	end
	return false
end

function digDown()
	if isChestDown() then
		turtle.select(1)
		t.digChestDown()
	else
		turtle.select(1)
		turtle.digDown()
	end
end

function digUp()
	if isChestUp() then
		turtle.select(1)
		t.digChestUp()
	else
		turtle.select(1)
		turtle.digUp()
	end
end

function checkWalls()
	for i=1,4 do
		if isValuable() then
			if isChest() then
				t.digChest()
			end
			turtle.select(1)
			turtle.dig()
		end
		turtle.turnRight()
	end
end

-- start program --

local depth = 0

digDown()
for i=1,2 do
	t.downAttack()
	turtle.select(1)
	digDown()
	depth = depth + 1
end

turtle.select(2)
turtle.placeUp()
-- dig tunnel
while not turtle.detectDown() do
	t.downAttack()
	checkWalls()
	if turtle.detectDown() then
		digDown()
	end
	depth = depth + 1
end

-- go up 10

turtle.select(1)
for i=1,10 do
	-- this is to protect against cobble/obsidian
	-- from lava/water reactions
	while turtle.detectUp() do
		turtle.digUp()
	end
	t.upAttack()
	depth = depth - 1
end

-- go to next position
for i=1,2 do
	while not t.forward() do
		turtle.dig()
		turtle.attack()
	end
end

turtle.turnLeft()
while not t.forward() do
	turtle.dig()
	turtle.attack()
end
turtle.turnRight()

-- dig down
digDown()
while not turtle.detectDown() do
	t.down()
	digDown()
	depth = depth + 1
end

-- dig up
while depth > 0 do
	checkWalls()
	-- this is to protect against cobble/obsidian
	-- from lava/water reactions
	while turtle.detectUp() do
		digUp()
		os.sleep(0.5)
	end
	t.upAttack()
	depth = depth - 1
end


turtle.select(2)
turtle.placeDown()
