function fuel()
	if turtle.getFuelLevel() <= 10 then
		turtle.select(1)
		turtle.refuel(1)
	end
end

-- pos 1 = fuel
-- pos 2 = plug
-- pos 3,4,5 = junk
-- pos 6 + = goodies
function isValuable()
	-- check junk
	for i=3,4 do
		turtle.select(i)
		if not turtle.detect() or turtle.compare() then
			return false
		end
	end

	return true
end

function isChest()
	turtle.select(5)
	if turtle.compare() then
		return true
	end
	return false
end

function eatChest()
	while turtle.suck() do
		os.sleep(1)
	end

	turtle.select(1)
	turtle.dig()
end

function isChestDown()
	turtle.select(5)
	if turtle.compareDown() then
		return true
	end
	return false
end

function suckChestDown()
	turtle.select(1)
	while turtle.suckDown() do
		os.sleep(1)
	end
end

function digDown()
	if isChestDown() then
		suckChestDown()
	end
	turtle.select(1)
	turtle.digDown()
end

function checkWalls()
	for i=1,4 do
		if isChest() then
			eatChest()
		elseif isValuable() then
			turtle.select(1)
			turtle.dig()
		end
		turtle.turnRight()
	end
end

-- start program --

fuel()

local depth = 0

digDown()
turtle.down()
if turtle.detectDown() then
	turtle.select(1)
	digDown()
end
depth = depth + 1

while not turtle.detectDown() do
	fuel()
	turtle.down()
	checkWalls()
	if turtle.detectDown() then
		turtle.select(1)
		digDown()
	end
	depth = depth + 1
end

for i=1,depth do
	-- this is to protect against cobble/obsidian
	-- from lava/water reactions
	while turtle.detectUp() do
		turtle.select(1)
		turtle.digUp()
	end
	turtle.up()
	fuel()
end

turtle.select(2)
turtle.placeDown()
