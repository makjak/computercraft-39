local FUEL = 1
local PLUG = 2
local CHEST = 3
local JUNKSTART = 4
local JUNKEND = 6

function isValuable()
	-- check junk
	for i=JUNKSTART,JUNKEND do
		turtle.select(i)
		if not turtle.detect() or turtle.compare() then
			return false
		end
	end

	return true
end

function isChest()
	turtle.select(CHEST)
	if turtle.compare() then
		return true
	end
	return false
end

function isChestDown()
	turtle.select(CHEST)
	if turtle.compareDown() then
		return true
	end
	return false
end

function isChestUp()
	turtle.select(CHEST)
	if turtle.compareUp() then
		return true
	end
	return false
end

function digDown()
	if isChestDown() then
		turtle.select(1)
		t.digChestDown()
	else
		turtle.select(1)
		turtle.digDown()
	end
end

function digUp()
	if isChestUp() then
		turtle.select(1)
		t.digChestUp()
	else
		turtle.select(1)
		turtle.digUp()
	end
end

function checkWalls()
	for i=1,4 do
		if isValuable() then
			if isChest() then
				t.digChest()
			end
			turtle.select(1)
			turtle.dig()
		end
		t.turnRight()
	end
end

function drillDown(dp)
	if turtle.detectDown() then
		digDown()
	end
	while not turtle.detectDown() do
		checkWalls()
		t.downAttack()
		if turtle.detectDown() then
			digDown()
		end
		dp = dp + 1
	end
	return dp
end

function drillUp(dp)
	while dp > 1 do
		checkWalls()
		while turtle.detectUp() do
			digUp()
			os.sleep(0.5)
		end
		t.upAttack()
		dp = dp - 1
	end

	return dp
end


-- start program --

local depth = 0

-- go down, place cap
digDown()
for i=1,2 do
	t.downAttack()
	turtle.select(1)
	digDown()
	depth = depth + 1
end

turtle.select(PLUG)
turtle.placeUp()

-- drill to bedrock hole 1
depth = drillDown(depth)

-- go up 10
turtle.select(1)
for i=1,10 do
	t.upDigAttack()
	depth = depth - 1
end

-- go to next position
t.forwardDigAttack()
t.forwardDigAttack()
t.turnLeft()
t.forwardDigAttack()
t.turnRight()

-- drill down
depth = drillDown(depth)

-- dig up -- hole 2
depth = drillUp(depth)

-- place cap
t.upDigAttack()
turtle.select(PLUG)
turtle.placeDown()

-- go to next place
t.forwardDigAttack()
t.forwardDigAttack()
t.turnLeft()
t.forwardDigAttack()
t.turnRight()
